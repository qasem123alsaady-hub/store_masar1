<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام إدارة المخزون - نظام الصلاحيات</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
* {
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
body {
margin: 0;
padding: 0;
background-color: #f5f5f5;
color: #333;
}
.container {
max-width: 1400px;
margin: 0 auto;
display: flex;
min-height: 100vh;
}
/* شريط التنقل الجانبي */
.sidebar {
width: 250px;
background-color: #2c3e50;
color: white;
padding: 20px 0;
}
.sidebar h2 {
text-align: center;
margin-bottom: 30px;
padding-bottom: 15px;
border-bottom: 1px solid #34495e;
}
.nav-links {
list-style: none;
padding: 0;
}
.nav-links li {
padding: 0;
}
.nav-links a {
display: block;
padding: 15px 25px;
color: #ecf0f1;
text-decoration: none;
transition: background-color 0.3s;
}
.nav-links a:hover, .nav-links a.active {
background-color: #34495e;
border-right: 4px solid #3498db;
}
/* المحتوى الرئيسي */
.main-content {
flex: 1;
padding: 20px;
background-color: white;
}
.page {
display: none;
}
.page.active {
display: block;
}
h1, h2 {
color: #2c3e50;
}
.form-section, .dashboard-section, .transaction-section, .reports-section, .login-section {
margin-bottom: 30px;
padding: 20px;
border: 1px solid #ddd;
border-radius: 5px;
}
.form-group {
margin-bottom: 15px;
}
label {
display: block;
margin-bottom: 5px;
font-weight: bold;
}
input, select, button {
width: 100%;
padding: 10px;
border: 1px solid #ddd;
border-radius: 4px;
font-size: 16px;
}
button {
background-color: #3498db;
color: white;
border: none;
cursor: pointer;
transition: background-color 0.3s;
}
button:hover {
background-color: #2980b9;
}
table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
}
th, td {
padding: 12px 15px;
text-align: right;
border-bottom: 1px solid #ddd;
}
th {
background-color: #f2f2f2;
font-weight: bold;
}
tr:hover {
background-color: #f9f9f9;
}
.actions button {
width: auto;
margin: 0 5px;
padding: 5px 10px;
font-size: 14px;
}
.edit-btn {
background-color: #f39c12;
}
.edit-btn:hover {
background-color: #e67e22;
}
.delete-btn {
background-color: #e74c3c;
}
.delete-btn:hover {
background-color: #c0392b;
}
.delete-transaction-btn {
background-color: #e74c3c;
padding: 3px 8px;
font-size: 12px;
}
.delete-transaction-btn:hover {
background-color: #c0392b;
}
.input-btn {
background-color: #27ae60;
}
.input-btn:hover {
background-color: #219653;
}
.output-btn {
background-color: #e74c3c;
}
.output-btn:hover {
background-color: #c0392b;
}
.export-btn {
background-color: #9b59b6;
}
.export-btn:hover {
background-color: #8e44ad;
}
.login-btn {
background-color: #2ecc71;
}
.login-btn:hover {
background-color: #27ae60;
}
.logout-btn {
background-color: #e74c3c;
width: auto;
padding: 8px 15px;
margin-bottom: 20px;
}
.logout-btn:hover {
background-color: #c0392b;
}
.stats {
display: flex;
justify-content: space-around;
margin-top: 20px;
padding: 15px;
background-color: #ecf0f1;
border-radius: 5px;
}
.stat-item {
text-align: center;
}
.stat-value {
font-size: 24px;
font-weight: bold;
color: #2c3e50;
}
.stat-label {
font-size: 14px;
color: #7f8c8d;
}
.categories-section {
margin-top: 20px;
padding: 15px;
border: 1px solid #ddd;
border-radius: 5px;
}
.categories-list {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-top: 10px;
}
.category-tag {
background-color: #3498db;
color: white;
padding: 5px 10px;
border-radius: 20px;
font-size: 14px;
}
.low-stock {
background-color: #ffebee;
}
.low-stock td {
color: #e53935;
font-weight: bold;
}
.alert-badge {
background-color: #e53935;
color: white;
border-radius: 50%;
width: 20px;
height: 20px;
display: inline-flex;
align-items: center;
justify-content: center;
font-size: 12px;
margin-right: 5px;
}
.transaction-history {
margin-top: 30px;
}
.input-row {
background-color: #e8f5e9;
}
.output-row {
background-color: #ffebee;
}
.products-table {
margin-top: 30px;
}
.report-filters {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-bottom: 20px;
padding: 15px;
background-color: #f8f9fa;
border-radius: 5px;
}
.export-buttons {
display: flex;
gap: 10px;
margin: 20px 0;
flex-wrap: wrap;
}
.export-buttons button {
width: auto;
padding: 10px 20px;
}
.report-summary {
background-color: #e3f2fd;
padding: 15px;
border-radius: 5px;
margin: 20px 0;
}
.user-info {
background-color: #2c3e50;
color: white;
padding: 10px 15px;
border-radius: 5px;
margin-bottom: 20px;
display: flex;
justify-content: space-between;
align-items: center;
}
.user-role {
background-color: #3498db;
padding: 3px 8px;
border-radius: 10px;
font-size: 12px;
}
.restricted {
opacity: 0.6;
pointer-events: none;
position: relative;
}
.restricted::after {
content: "غير مسموح";
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background-color: rgba(231, 76, 60, 0.9);
color: white;
padding: 5px 10px;
border-radius: 5px;
font-size: 14px;
}
.hidden {
display: none !important;
}
.transaction-actions {
display: flex;
gap: 5px;
justify-content: center;
}
@media (max-width: 768px) {
.container {
flex-direction: column;
}
.sidebar {
width: 100%;
}
.stats {
flex-direction: column;
}
.stat-item {
margin-bottom: 15px;
}
.actions {
display: flex;
flex-direction: column;
gap: 5px;
}
.actions button {
width: 100%;
margin: 2px 0;
}
.export-buttons {
flex-direction: column;
}
.export-buttons button {
width: 100%;
}
.user-info {
flex-direction: column;
gap: 10px;
text-align: center;
}
.transaction-actions {
flex-direction: column;
}
}
</style>
</head>
<body>
<div class="container">
<!-- شريط التنقل الجانبي -->
<div class="sidebar">
<h2>نظام إدارة المخزون</h2>
<ul class="nav-links">
<li><a href="#" class="nav-link active" data-page="dashboard">لوحة التحكم المركزية</a></li>
<li><a href="#" class="nav-link" data-page="products">إدارة المنتجات</a></li>
<li><a href="#" class="nav-link" data-page="inputs">مدخلات المخزن</a></li>
<li><a href="#" class="nav-link" data-page="outputs">مخرجات المخزن</a></li>
<li><a href="#" class="nav-link reports-link" data-page="transactions">سجل الحركات</a></li>
<li><a href="#" class="nav-link reports-link" data-page="reports">التقارير</a></li>
</ul>
</div>
<!-- المحتوى الرئيسي -->
<div class="main-content">
<!-- صفحة تسجيل الدخول -->
<div id="login" class="page active">
<div class="login-section">
<h1>تسجيل الدخول</h1>
<form id="loginForm">
<div class="form-group">
<label for="username">اسم المستخدم:</label>
<input type="text" id="username" required>
</div>
<div class="form-group">
<label for="password">كلمة المرور:</label>
<input type="password" id="password" required>
</div>
<div class="form-group">
<label for="userType">نوع الحساب:</label>
<select id="userType" required>
<option value="">اختر نوع الحساب</option>
<option value="admin">مدير النظام (صلاحيات كاملة)</option>
<option value="user">مستخدم عادي (صلاحيات محدودة)</option>
</select>
</div>
<button type="submit" class="login-btn">تسجيل الدخول</button>
</form>
<div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
<h3>بيانات الحسابات للاختبار:</h3>
<p><strong>المدير:</strong> اسم المستخدم: admin | كلمة المرور: admin123</p>
<p><strong>المستخدم العادي:</strong> اسم المستخدم: user | كلمة المرور: user123</p>
</div>
</div>
</div>
<!-- صفحة لوحة التحكم المركزية -->
<div id="dashboard" class="page">
<div class="user-info">
<div>
<span>مرحباً, <strong id="currentUserName">المستخدم</strong></span>
<span class="user-role" id="currentUserRole">مدير النظام</span>
</div>
<button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
</div>
<h1>لوحة التحكم المركزية</h1>
<div class="stats">
<div class="stat-item">
<div class="stat-value" id="totalProducts">0</div>
<div class="stat-label">إجمالي المنتجات</div>
</div>
<div class="stat-item">
<div class="stat-value" id="totalQuantity">0</div>
<div class="stat-label">إجمالي الكمية</div>
</div>
<div class="stat-item">
<div class="stat-value" id="totalCategories">0</div>
<div class="stat-label">إجمالي الفئات</div>
</div>
<div class="stat-item">
<div class="stat-value" id="lowStockItems">0</div>
<div class="stat-label">منتجات تحت الحد الأدنى</div>
</div>
</div>
<div class="dashboard-section">
<h2>المخزون الحالي</h2>
<table id="inventoryTable">
<thead>
<tr>
<th>اسم المنتج</th>
<th>الفئة</th>
<th>الكمية</th>
<th>الحد الأدنى للطلب</th>
<th>الحالة</th>
</tr>
</thead>
<tbody id="inventoryBody">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</tbody>
</table>
</div>
</div>
<!-- صفحة إدارة المنتجات -->
<div id="products" class="page">
<div class="user-info">
<div>
<span>مرحباً, <strong id="currentUserNameProducts">المستخدم</strong></span>
<span class="user-role" id="currentUserRoleProducts">مدير النظام</span>
</div>
<button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
</div>
<h1>إدارة المنتجات</h1>
<div class="form-section" id="productFormSection">
<h2>إضافة / تعديل منتج</h2>
<form id="productForm">
<input type="hidden" id="productId">
<div class="form-group">
<label for="productName">اسم المنتج:</label>
<input type="text" id="productName" required>
</div>
<div class="form-group">
<label for="productCategory">الفئة:</label>
<input type="text" id="productCategory" list="categoriesList" required>
<datalist id="categoriesList">
<!-- سيتم ملؤها تلقائياً من الفئات الموجودة -->
</datalist>
</div>
<div class="form-group">
<label for="productQuantity">الكمية:</label>
<input type="number" id="productQuantity" min="0" required>
</div>
<div class="form-group">
<label for="minOrder">الحد الأدنى للطلب:</label>
<input type="number" id="minOrder" min="0" required>
</div>
<button type="submit" id="submitBtn">إضافة منتج</button>
</form>
</div>
<div class="categories-section">
<h3>الفئات المتاحة</h3>
<div class="categories-list" id="categoriesContainer">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</div>
</div>
<div class="products-table">
<h2>قائمة المنتجات</h2>
<table id="productsTable">
<thead>
<tr>
<th>اسم المنتج</th>
<th>الفئة</th>
<th>الكمية</th>
<th>الحد الأدنى للطلب</th>
<th>الإجراءات</th>
</tr>
</thead>
<tbody id="productsBody">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</tbody>
</table>
</div>
</div>
<!-- صفحة مدخلات المخزن -->
<div id="inputs" class="page">
<div class="user-info">
<div>
<span>مرحباً, <strong id="currentUserNameInputs">المستخدم</strong></span>
<span class="user-role" id="currentUserRoleInputs">مدير النظام</span>
</div>
<button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
</div>
<h1>مدخلات المخزن</h1>
<div class="transaction-section">
<h2>إضافة كمية جديدة للمنتج</h2>
<form id="inputForm">
<div class="form-group">
<label for="inputProduct">اختر المنتج:</label>
<select id="inputProduct" required>
<option value="">اختر المنتج</option>
</select>
</div>
<div class="form-group">
<label for="inputQuantity">الكمية المضافة:</label>
<input type="number" id="inputQuantity" min="1" required>
</div>
<div class="form-group">
<label for="inputPerson">اسم المدخل:</label>
<input type="text" id="inputPerson" required>
</div>
<div class="form-group">
<label for="inputDate">تاريخ الإدخال:</label>
<input type="date" id="inputDate" required>
</div>
<button type="submit" class="input-btn">إضافة إلى المخزن</button>
</form>
</div>
<div class="transaction-history">
<h2>سجل المدخلات</h2>
<table id="inputsTable">
<thead>
<tr>
<th>التاريخ</th>
<th>اسم المنتج</th>
<th>الكمية</th>
<th>اسم المدخل</th>
<th class="admin-only-header">الإجراءات</th>
</tr>
</thead>
<tbody id="inputsBody">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</tbody>
</table>
</div>
</div>
<!-- صفحة مخرجات المخزن -->
<div id="outputs" class="page">
<div class="user-info">
<div>
<span>مرحباً, <strong id="currentUserNameOutputs">المستخدم</strong></span>
<span class="user-role" id="currentUserRoleOutputs">مدير النظام</span>
</div>
<button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
</div>
<h1>مخرجات المخزن</h1>
<div class="transaction-section">
<h2>إخراج كمية من المنتج</h2>
<form id="outputForm">
<div class="form-group">
<label for="outputProduct">اختر المنتج:</label>
<select id="outputProduct" required>
<option value="">اختر المنتج</option>
</select>
</div>
<div class="form-group">
<label for="outputQuantity">الكمية المخرجة:</label>
<input type="number" id="outputQuantity" min="1" required>
</div>
<div class="form-group">
<label for="outputPerson">اسم المخرج:</label>
<input type="text" id="outputPerson" required>
</div>
<div class="form-group">
<label for="outputDate">تاريخ الإخراج:</label>
<input type="date" id="outputDate" required>
</div>
<button type="submit" class="output-btn">إخراج من المخزن</button>
</form>
</div>
<div class="transaction-history">
<h2>سجل المخرجات</h2>
<table id="outputsTable">
<thead>
<tr>
<th>التاريخ</th>
<th>اسم المنتج</th>
<th>الكمية</th>
<th>اسم المخرج</th>
<th class="admin-only-header">الإجراءات</th>
</tr>
</thead>
<tbody id="outputsBody">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</tbody>
</table>
</div>
</div>
<!-- صفحة سجل الحركات -->
<div id="transactions" class="page">
<div class="user-info">
<div>
<span>مرحباً, <strong id="currentUserNameTransactions">المستخدم</strong></span>
<span class="user-role" id="currentUserRoleTransactions">مدير النظام</span>
</div>
<button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
</div>
<h1>سجل حركات المخزن</h1>
<div class="transaction-history">
<h2>جميع الحركات</h2>
<table id="transactionsTable">
<thead>
<tr>
<th>التاريخ</th>
<th>نوع الحركة</th>
<th>اسم المنتج</th>
<th>الكمية</th>
<th>المستخدم</th>
<th class="admin-only-header">الإجراءات</th>
</tr>
</thead>
<tbody id="transactionsBody">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</tbody>
</table>
</div>
</div>
<!-- صفحة التقارير -->
<div id="reports" class="page">
<div class="user-info">
<div>
<span>مرحباً, <strong id="currentUserNameReports">المستخدم</strong></span>
<span class="user-role" id="currentUserRoleReports">مدير النظام</span>
</div>
<button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
</div>
<h1>تقارير المخزون</h1>
<div class="reports-section">
<h2>تصفية البيانات</h2>
<div class="report-filters">
<div class="form-group">
<label for="reportType">نوع التقرير:</label>
<select id="reportType">
<option value="inventory">تقرير المخزون الحالي</option>
<option value="movements">تقرير حركات المخزون</option>
<option value="lowstock">تقرير المنتجات المنخفضة</option>
<option value="inputs">تقرير المدخلات</option>
<option value="outputs">تقرير المخرجات</option>
</select>
</div>
<div class="form-group">
<label for="startDate">من تاريخ:</label>
<input type="date" id="startDate">
</div>
<div class="form-group">
<label for="endDate">إلى تاريخ:</label>
<input type="date" id="endDate">
</div>
<div class="form-group">
<label for="reportCategory">الفئة:</label>
<select id="reportCategory">
<option value="">جميع الفئات</option>
</select>
</div>
</div>
<div class="export-buttons">
<button class="export-btn" onclick="generateReport()">عرض التقرير</button>
<button class="export-btn" onclick="exportToExcel()">تصدير إلى Excel</button>
<button class="export-btn" onclick="exportToPDF()">تصدير إلى PDF</button>
</div>
<div class="report-summary" id="reportSummary">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</div>
<div id="reportResults">
<!-- سيتم ملؤها بالبيانات من JavaScript -->
</div>
</div>
</div>
</div>
</div>
<script>
// بيانات المستخدمين
const users = {
admin: { password: 'admin123', role: 'admin', name: 'مدير النظام' },
user: { password: 'user123', role: 'user', name: 'مستخدم عادي' }
};
// بيانات التطبيق
let currentUser = null;
let products = JSON.parse(localStorage.getItem('inventoryProducts')) || [];
let categories = JSON.parse(localStorage.getItem('inventoryCategories')) || [];
let inputs = JSON.parse(localStorage.getItem('inventoryInputs')) || [];
let outputs = JSON.parse(localStorage.getItem('inventoryOutputs')) || [];
let editingProductId = null;
// عناصر DOM
const loginForm = document.getElementById('loginForm');
const productForm = document.getElementById('productForm');
const inputForm = document.getElementById('inputForm');
const outputForm = document.getElementById('outputForm');
const productIdInput = document.getElementById('productId');
const productNameInput = document.getElementById('productName');
const productCategoryInput = document.getElementById('productCategory');
const productQuantityInput = document.getElementById('productQuantity');
const minOrderInput = document.getElementById('minOrder');
const inputProductSelect = document.getElementById('inputProduct');
const inputQuantityInput = document.getElementById('inputQuantity');
const inputPersonInput = document.getElementById('inputPerson');
const inputDateInput = document.getElementById('inputDate');
const outputProductSelect = document.getElementById('outputProduct');
const outputQuantityInput = document.getElementById('outputQuantity');
const outputPersonInput = document.getElementById('outputPerson');
const outputDateInput = document.getElementById('outputDate');
const submitBtn = document.getElementById('submitBtn');
const inventoryBody = document.getElementById('inventoryBody');
const productsBody = document.getElementById('productsBody');
const inputsBody = document.getElementById('inputsBody');
const outputsBody = document.getElementById('outputsBody');
const transactionsBody = document.getElementById('transactionsBody');
const categoriesContainer = document.getElementById('categoriesContainer');
const categoriesList = document.getElementById('categoriesList');
const reportCategorySelect = document.getElementById('reportCategory');
const totalProductsEl = document.getElementById('totalProducts');
const totalQuantityEl = document.getElementById('totalQuantity');
const totalCategoriesEl = document.getElementById('totalCategories');
const lowStockItemsEl = document.getElementById('lowStockItems');
const navLinks = document.querySelectorAll('.nav-link');
const pages = document.querySelectorAll('.page');
const reportSummary = document.getElementById('reportSummary');
const reportResults = document.getElementById('reportResults');
const reportsLinks = document.querySelectorAll('.reports-link');
// توليد معرف فريد للمنتج
function generateId() {
return Date.now().toString(36) + Math.random().toString(36).substr(2);
}
// حفظ البيانات في localStorage
function saveData() {
localStorage.setItem('inventoryProducts', JSON.stringify(products));
localStorage.setItem('inventoryCategories', JSON.stringify(categories));
localStorage.setItem('inventoryInputs', JSON.stringify(inputs));
localStorage.setItem('inventoryOutputs', JSON.stringify(outputs));
}
// تحديث واجهة المستخدم حسب الصلاحيات
function updateUIForPermissions() {
const isAdmin = currentUser.role === 'admin';
// تحديث معلومات المستخدم في جميع الصفحات
document.querySelectorAll('[id^="currentUserName"]').forEach(el => {
el.textContent = currentUser.name;
});
document.querySelectorAll('[id^="currentUserRole"]').forEach(el => {
el.textContent = isAdmin ? 'مدير النظام' : 'مستخدم عادي';
});
// إظهار/إخفاء أقسام حسب الصلاحيات
if (!isAdmin) {
// إخفاء أزرار الحذف والتعديل
document.querySelectorAll('.delete-btn, .edit-btn').forEach(btn => {
btn.classList.add('restricted');
});
// إخفاء قسم التقارير من القائمة
reportsLinks.forEach(link => {
link.classList.add('hidden');
});
// إخفاء أزرار التصدير
document.querySelectorAll('.export-btn').forEach(btn => {
btn.classList.add('restricted');
});
// إخفاء قسم إضافة/تعديل المنتجات
document.getElementById('productFormSection').classList.add('restricted');
// إخفاء أعمدة الإجراءات في الجداول
document.querySelectorAll('.admin-only-header').forEach(header => {
header.classList.add('hidden');
});
} else {
// إظهار كل شيء للمدير
document.querySelectorAll('.restricted').forEach(el => {
el.classList.remove('restricted');
});
reportsLinks.forEach(link => {
link.classList.remove('hidden');
});
document.getElementById('productFormSection').classList.remove('restricted');
// إظهار أعمدة الإجراءات في الجداول
document.querySelectorAll('.admin-only-header').forEach(header => {
header.classList.remove('hidden');
});
}
}
// تسجيل الدخول
loginForm.addEventListener('submit', function(e) {
e.preventDefault();
const username = document.getElementById('username').value;
const password = document.getElementById('password').value;
const userType = document.getElementById('userType').value;
if (!username || !password || !userType) {
alert('يرجى ملء جميع الحقول');
return;
}
// التحقق من بيانات المستخدم
if (users[username] && users[username].password === password && users[username].role === userType) {
currentUser = {
username: username,
role: userType,
name: users[username].name
};
// حفظ حالة المستخدم
localStorage.setItem('currentUser', JSON.stringify(currentUser));
// الانتقال إلى لوحة التحكم
showPage('dashboard');
updateUIForPermissions();
renderProducts();
renderInputs();
renderOutputs();
renderTransactions();
updateCategories();
} else {
alert('بيانات الدخول غير صحيحة');
}
});
// تسجيل الخروج
function logout() {
currentUser = null;
localStorage.removeItem('currentUser');
showPage('login');
loginForm.reset();
}
// التحقق من حالة المستخدم عند تحميل الصفحة
function checkUserStatus() {
const savedUser = localStorage.getItem('currentUser');
if (savedUser) {
currentUser = JSON.parse(savedUser);
showPage('dashboard');
updateUIForPermissions();
renderProducts();
renderInputs();
renderOutputs();
renderTransactions();
updateCategories();
} else {
showPage('login');
}
}
// إظهار صفحة محددة
function showPage(pageId) {
pages.forEach(page => page.classList.remove('active'));
navLinks.forEach(link => link.classList.remove('active'));
document.getElementById(pageId).classList.add('active');
if (pageId !== 'login') {
document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
}
}
// التنقل بين الصفحات
navLinks.forEach(link => {
link.addEventListener('click', function(e) {
e.preventDefault();
if (!currentUser) return;
const pageId = this.getAttribute('data-page');
showPage(pageId);
});
});
// تحديث الإحصائيات
function updateStats() {
const totalProducts = products.length;
const totalQuantity = products.reduce((sum, product) => sum + parseInt(product.quantity), 0);
const totalCategories = categories.length;
const lowStockItems = products.filter(product => product.quantity <= product.minOrder).length;
totalProductsEl.textContent = totalProducts;
totalQuantityEl.textContent = totalQuantity;
totalCategoriesEl.textContent = totalCategories;
lowStockItemsEl.textContent = lowStockItems;
}
// تحديث قائمة الفئات
function updateCategories() {
// تحديث datalist للاقتراح التلقائي
categoriesList.innerHTML = '';
categories.forEach(category => {
const option = document.createElement('option');
option.value = category;
categoriesList.appendChild(option);
});
// تحديث عرض الفئات
categoriesContainer.innerHTML = '';
categories.forEach(category => {
const tag = document.createElement('div');
tag.className = 'category-tag';
tag.textContent = category;
categoriesContainer.appendChild(tag);
});
// تحديث قائمة الفئات في التقارير
reportCategorySelect.innerHTML = '<option value="">جميع الفئات</option>';
categories.forEach(category => {
const option = document.createElement('option');
option.value = category;
option.textContent = category;
reportCategorySelect.appendChild(option);
});
}
// تحديث قائمة المنتجات في المدخلات والمخرجات
function updateProductSelects() {
inputProductSelect.innerHTML = '<option value="">اختر المنتج</option>';
outputProductSelect.innerHTML = '<option value="">اختر المنتج</option>';
products.forEach(product => {
const inputOption = document.createElement('option');
inputOption.value = product.id;
inputOption.textContent = `${product.name} (${product.quantity} متوفر)`;
inputProductSelect.appendChild(inputOption);
const outputOption = document.createElement('option');
outputOption.value = product.id;
outputOption.textContent = `${product.name} (${product.quantity} متوفر)`;
outputProductSelect.appendChild(outputOption);
});
}
// إضافة فئة جديدة إذا كانت غير موجودة
function addCategory(categoryName) {
if (categoryName && !categories.includes(categoryName)) {
categories.push(categoryName);
saveData();
updateCategories();
}
}
// عرض المنتجات في الجدول
function renderProducts() {
inventoryBody.innerHTML = '';
productsBody.innerHTML = '';
products.forEach(product => {
const isLowStock = product.quantity <= product.minOrder;
// جدول لوحة التحكم
const inventoryRow = document.createElement('tr');
if (isLowStock) {
inventoryRow.classList.add('low-stock');
}
inventoryRow.innerHTML = `
<td>${product.name}</td>
<td>${product.category}</td>
<td>${product.quantity}</td>
<td>${product.minOrder}</td>
<td>
${isLowStock ? '<span class="alert-badge">!</span> تحت الحد الأدنى' : 'مستوى جيد'}
</td>
`;
inventoryBody.appendChild(inventoryRow);
// جدول إدارة المنتجات
const productsRow = document.createElement('tr');
const actionsHtml = currentUser.role === 'admin' ?
`<td class="actions">
<button class="edit-btn" onclick="editProduct('${product.id}')">تعديل</button>
<button class="delete-btn" onclick="deleteProduct('${product.id}')">حذف</button>
</td>` :
`<td class="actions restricted"></td>`;
productsRow.innerHTML = `
<td>${product.name}</td>
<td>${product.category}</td>
<td>${product.quantity}</td>
<td>${product.minOrder}</td>
${actionsHtml}
`;
productsBody.appendChild(productsRow);
});
updateStats();
updateProductSelects();
}
// عرض سجل المدخلات
function renderInputs() {
inputsBody.innerHTML = '';
inputs.forEach(input => {
const row = document.createElement('tr');
row.classList.add('input-row');
const actionsHtml = currentUser.role === 'admin' ?
`<td class="transaction-actions">
<button class="delete-transaction-btn" onclick="deleteInput('${input.id}')">حذف</button>
</td>` :
`<td></td>`;
row.innerHTML = `
<td>${input.date}</td>
<td>${input.productName}</td>
<td>${input.quantity}</td>
<td>${input.person}</td>
${actionsHtml}
`;
inputsBody.appendChild(row);
});
}
// عرض سجل المخرجات
function renderOutputs() {
outputsBody.innerHTML = '';
outputs.forEach(output => {
const row = document.createElement('tr');
row.classList.add('output-row');
const actionsHtml = currentUser.role === 'admin' ?
`<td class="transaction-actions">
<button class="delete-transaction-btn" onclick="deleteOutput('${output.id}')">حذف</button>
</td>` :
`<td></td>`;
row.innerHTML = `
<td>${output.date}</td>
<td>${output.productName}</td>
<td>${output.quantity}</td>
<td>${output.person}</td>
${actionsHtml}
`;
outputsBody.appendChild(row);
});
}
// عرض سجل جميع الحركات
function renderTransactions() {
transactionsBody.innerHTML = '';
// دمج المدخلات والمخرجات وفرزها حسب التاريخ
const allTransactions = [
...inputs.map(input => ({...input, type: 'مدخل', typeClass: 'input-row', transactionType: 'input'})),
...outputs.map(output => ({...output, type: 'مخرج', typeClass: 'output-row', transactionType: 'output'}))
].sort((a, b) => new Date(b.date) - new Date(a.date));
allTransactions.forEach(transaction => {
const row = document.createElement('tr');
row.classList.add(transaction.typeClass);
const actionsHtml = currentUser.role === 'admin' ?
`<td class="transaction-actions">
<button class="delete-transaction-btn" onclick="deleteTransaction('${transaction.id}', '${transaction.transactionType}')">حذف</button>
</td>` :
`<td></td>`;
row.innerHTML = `
<td>${transaction.date}</td>
<td>${transaction.type}</td>
<td>${transaction.productName}</td>
<td>${transaction.quantity}</td>
<td>${transaction.person}</td>
${actionsHtml}
`;
transactionsBody.appendChild(row);
});
}
// حذف حركة مدخل
function deleteInput(inputId) {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بحذف الحركات');
return;
}
const input = inputs.find(i => i.id === inputId);
if (!input) return;
if (confirm(`هل أنت متأكد من حذف حركة الإدخال هذه؟\nالمنتج: ${input.productName}\nالكمية: ${input.quantity}\nالتاريخ: ${input.date}`)) {
// العثور على المنتج المرتبط وتحديث كميته
const product = products.find(p => p.id === input.productId);
if (product) {
product.quantity -= input.quantity;
}
// حذف الحركة
inputs = inputs.filter(i => i.id !== inputId);
saveData();
renderProducts();
renderInputs();
renderTransactions();
alert('تم حذف حركة الإدخال بنجاح');
}
}
// حذف حركة مخرج
function deleteOutput(outputId) {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بحذف الحركات');
return;
}
const output = outputs.find(o => o.id === outputId);
if (!output) return;
if (confirm(`هل أنت متأكد من حذف حركة الإخراج هذه؟\nالمنتج: ${output.productName}\nالكمية: ${output.quantity}\nالتاريخ: ${output.date}`)) {
// العثور على المنتج المرتبط وتحديث كميته
const product = products.find(p => p.id === output.productId);
if (product) {
product.quantity += output.quantity;
}
// حذف الحركة
outputs = outputs.filter(o => o.id !== outputId);
saveData();
renderProducts();
renderOutputs();
renderTransactions();
alert('تم حذف حركة الإخراج بنجاح');
}
}
// حذف حركة عامة (من صفحة سجل الحركات)
function deleteTransaction(transactionId, transactionType) {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بحذف الحركات');
return;
}
if (transactionType === 'input') {
deleteInput(transactionId);
} else if (transactionType === 'output') {
deleteOutput(transactionId);
}
}
// توليد التقرير
function generateReport() {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بالوصول إلى التقارير');
return;
}
const reportType = document.getElementById('reportType').value;
const startDate = document.getElementById('startDate').value;
const endDate = document.getElementById('endDate').value;
const category = document.getElementById('reportCategory').value;
let reportData = [];
let title = '';
let summary = '';
// تطبيق الفلاتر
const filteredProducts = category ?
products.filter(p => p.category === category) :
products;
const filteredInputs = filterByDate(inputs, startDate, endDate);
const filteredOutputs = filterByDate(outputs, startDate, endDate);
switch(reportType) {
case 'inventory':
title = 'تقرير المخزون الحالي';
reportData = filteredProducts;
summary = `إجمالي المنتجات: ${reportData.length} | إجمالي الكمية: ${reportData.reduce((sum, p) => sum + parseInt(p.quantity), 0)}`;
break;
case 'movements':
title = 'تقرير حركات المخزون';
reportData = [
...filteredInputs.map(i => ({...i, type: 'مدخل'})),
...filteredOutputs.map(o => ({...o, type: 'مخرج'}))
].sort((a, b) => new Date(b.date) - new Date(a.date));
summary = `إجمالي الحركات: ${reportData.length} | المدخلات: ${filteredInputs.length} | المخرجات: ${filteredOutputs.length}`;
break;
case 'lowstock':
title = 'تقرير المنتجات المنخفضة';
reportData = filteredProducts.filter(p => p.quantity <= p.minOrder);
summary = `عدد المنتجات المنخفضة: ${reportData.length}`;
break;
case 'inputs':
title = 'تقرير المدخلات';
reportData = filteredInputs;
summary = `إجمالي المدخلات: ${reportData.length} | الكمية الإجمالية: ${reportData.reduce((sum, i) => sum + parseInt(i.quantity), 0)}`;
break;
case 'outputs':
title = 'تقرير المخرجات';
reportData = filteredOutputs;
summary = `إجمالي المخرجات: ${reportData.length} | الكمية الإجمالية: ${reportData.reduce((sum, o) => sum + parseInt(o.quantity), 0)}`;
break;
}
// عرض التقرير
displayReport(title, summary, reportData, reportType);
}
// تصفية البيانات حسب التاريخ
function filterByDate(data, startDate, endDate) {
if (!startDate && !endDate) return data;
return data.filter(item => {
const itemDate = new Date(item.date);
const start = startDate ? new Date(startDate) : new Date('1900-01-01');
const end = endDate ? new Date(endDate) : new Date('2100-01-01');
return itemDate >= start && itemDate <= end;
});
}
// عرض التقرير في الصفحة
function displayReport(title, summary, data, type) {
reportSummary.innerHTML = `
<h3>${title}</h3>
<p><strong>ملخص التقرير:</strong> ${summary}</p>
<p><strong>عدد السجلات:</strong> ${data.length}</p>
<p><strong>تاريخ الإنشاء:</strong> ${new Date().toLocaleDateString('ar-EG')}</p>
`;
let tableHTML = `
<table border="1" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
<thead>
<tr style="background-color: #f2f2f2;">
`;
// رؤوس الجدول حسب نوع التقرير
switch(type) {
case 'inventory':
tableHTML += `
<th>اسم المنتج</th>
<th>الفئة</th>
<th>الكمية</th>
<th>الحد الأدنى</th>
<th>الحالة</th>
`;
break;
case 'movements':
tableHTML += `
<th>التاريخ</th>
<th>نوع الحركة</th>
<th>اسم المنتج</th>
<th>الكمية</th>
<th>المستخدم</th>
`;
break;
case 'lowstock':
tableHTML += `
<th>اسم المنتج</th>
<th>الفئة</th>
<th>الكمية</th>
<th>الحد الأدنى</th>
<th>النقص</th>
`;
break;
case 'inputs':
case 'outputs':
tableHTML += `
<th>التاريخ</th>
<th>اسم المنتج</th>
<th>الكمية</th>
<th>المستخدم</th>
`;
break;
}
tableHTML += `</tr></thead><tbody>`;
// بيانات الجدول
data.forEach(item => {
tableHTML += `<tr>`;
switch(type) {
case 'inventory':
const status = item.quantity <= item.minOrder ? 'تحت الحد الأدنى' : 'مستوى جيد';
tableHTML += `
<td>${item.name}</td>
<td>${item.category}</td>
<td>${item.quantity}</td>
<td>${item.minOrder}</td>
<td>${status}</td>
`;
break;
case 'movements':
tableHTML += `
<td>${item.date}</td>
<td>${item.type}</td>
<td>${item.productName}</td>
<td>${item.quantity}</td>
<td>${item.person}</td>
`;
break;
case 'lowstock':
const deficit = item.minOrder - item.quantity;
tableHTML += `
<td>${item.name}</td>
<td>${item.category}</td>
<td>${item.quantity}</td>
<td>${item.minOrder}</td>
<td>${deficit > 0 ? deficit : 0}</td>
`;
break;
case 'inputs':
case 'outputs':
tableHTML += `
<td>${item.date}</td>
<td>${item.productName}</td>
<td>${item.quantity}</td>
<td>${item.person}</td>
`;
break;
}
tableHTML += `</tr>`;
});
tableHTML += `</tbody></table>`;
reportResults.innerHTML = tableHTML;
}
// تصدير إلى Excel
function exportToExcel() {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بتصدير التقارير');
return;
}
const reportType = document.getElementById('reportType').value;
const table = reportResults.querySelector('table');
if (!table) {
alert('يرجى إنشاء التقرير أولاً');
return;
}
const ws = XLSX.utils.table_to_sheet(table);
const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, "تقرير المخزون");
XLSX.writeFile(wb, `تقرير_المخزون_${new Date().toISOString().split('T')[0]}.xlsx`);
}
// تصدير إلى PDF
function exportToPDF() {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بتصدير التقارير');
return;
}
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
const reportType = document.getElementById('reportType').value;
const title = reportSummary.querySelector('h3').textContent;
const summary = reportSummary.querySelector('p').textContent;
const table = reportResults.querySelector('table');
if (!table) {
alert('يرجى إنشاء التقرير أولاً');
return;
}
// إعداد الخط للغة العربية
doc.setLanguage('ar');
// إضافة العنوان والملخص
doc.setFontSize(16);
doc.text(title, 105, 15, { align: 'center' });
doc.setFontSize(10);
const summaryLines = doc.splitTextToSize(summary, 180);
doc.text(summaryLines, 105, 25, { align: 'center' });
doc.text(`تاريخ الإنشاء: ${new Date().toLocaleDateString('ar-EG')}`, 105, 35, { align: 'center' });
// تحويل الجدول HTML إلى بيانات للـ PDF
const headers = [];
const rows = [];
// الحصول على رؤوس الجدول
const headerCells = table.querySelectorAll('thead th');
headerCells.forEach(cell => {
headers.push(cell.textContent);
});
// الحصول على بيانات الجدول
const dataRows = table.querySelectorAll('tbody tr');
dataRows.forEach(row => {
const rowData = [];
const cells = row.querySelectorAll('td');
cells.forEach(cell => {
rowData.push(cell.textContent);
});
rows.push(rowData);
});
// إضافة الجدول إلى الـ PDF
doc.autoTable({
head: [headers],
body: rows,
startY: 45,
styles: {
font: 'helvetica',
fontSize: 8,
cellPadding: 3,
textColor: [0, 0, 0]
},
headStyles: {
fillColor: [242, 242, 242],
textColor: [0, 0, 0],
fontStyle: 'bold'
},
alternateRowStyles: {
fillColor: [245, 245, 245]
},
margin: { top: 45 }
});
// حفظ الملف
doc.save(`تقرير_المخزون_${new Date().toISOString().split('T')[0]}.pdf`);
}
// إضافة أو تعديل منتج
productForm.addEventListener('submit', function(e) {
e.preventDefault();
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بإضافة أو تعديل المنتجات');
return;
}
const productData = {
name: productNameInput.value,
category: productCategoryInput.value,
quantity: parseInt(productQuantityInput.value),
minOrder: parseInt(minOrderInput.value)
};
if (editingProductId) {
// تعديل منتج موجود
const index = products.findIndex(p => p.id === editingProductId);
if (index !== -1) {
products[index] = { ...products[index], ...productData };
}
editingProductId = null;
submitBtn.textContent = 'إضافة منتج';
} else {
// إضافة منتج جديد
productData.id = generateId();
products.push(productData);
}
// إضافة الفئة إذا كانت جديدة
addCategory(productData.category);
saveData();
renderProducts();
productForm.reset();
productIdInput.value = '';
alert(editingProductId ? 'تم تعديل المنتج بنجاح' : 'تم إضافة المنتج بنجاح');
});
// إضافة مدخلات للمخزن
inputForm.addEventListener('submit', function(e) {
e.preventDefault();
const productId = inputProductSelect.value;
const quantity = parseInt(inputQuantityInput.value);
const person = inputPersonInput.value;
const date = inputDateInput.value;
if (!productId) {
alert('يرجى اختيار منتج');
return;
}
const product = products.find(p => p.id === productId);
if (!product) {
alert('المنتج غير موجود');
return;
}
// تحديث كمية المنتج
product.quantity += quantity;
// تسجيل الحركة
const inputRecord = {
id: generateId(),
productId: productId,
productName: product.name,
quantity: quantity,
person: person,
date: date
};
inputs.push(inputRecord);
saveData();
renderProducts();
renderInputs();
renderTransactions();
inputForm.reset();
alert(`تم إضافة ${quantity} وحدة من ${product.name} إلى المخزن`);
});
// إخراج منتجات من المخزن
outputForm.addEventListener('submit', function(e) {
e.preventDefault();
const productId = outputProductSelect.value;
const quantity = parseInt(outputQuantityInput.value);
const person = outputPersonInput.value;
const date = outputDateInput.value;
if (!productId) {
alert('يرجى اختيار منتج');
return;
}
const product = products.find(p => p.id === productId);
if (!product) {
alert('المنتج غير موجود');
return;
}
if (product.quantity < quantity) {
alert(`الكمية المتاحة غير كافية. المتوفر: ${product.quantity}`);
return;
}
// تحديث كمية المنتج
product.quantity -= quantity;
// تسجيل الحركة
const outputRecord = {
id: generateId(),
productId: productId,
productName: product.name,
quantity: quantity,
person: person,
date: date
};
outputs.push(outputRecord);
saveData();
renderProducts();
renderOutputs();
renderTransactions();
outputForm.reset();
alert(`تم إخراج ${quantity} وحدة من ${product.name} من المخزن`);
});
// تعديل منتج
function editProduct(id) {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بتعديل المنتجات');
return;
}
const product = products.find(p => p.id === id);
if (product) {
productIdInput.value = product.id;
productNameInput.value = product.name;
productCategoryInput.value = product.category;
productQuantityInput.value = product.quantity;
minOrderInput.value = product.minOrder;
editingProductId = id;
submitBtn.textContent = 'تحديث المنتج';
// التمرير إلى النموذج
document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
}
}
// حذف منتج
function deleteProduct(id) {
if (currentUser.role !== 'admin') {
alert('غير مسموح لك بحذف المنتجات');
return;
}
const product = products.find(p => p.id === id);
if (!product) return;
if (confirm(`هل أنت متأكد من حذف المنتج "${product.name}"؟\nهذا الإجراء لا يمكن التراجع عنه.`)) {
// التحقق من وجود حركات للمنتج
const hasInputs = inputs.some(input => input.productId === id);
const hasOutputs = outputs.some(output => output.productId === id);
if (hasInputs || hasOutputs) {
if (confirm('هذا المنتج لديه حركات في السجل. هل تريد حذفه مع جميع حركاته؟')) {
// حذف جميع الحركات المرتبطة بالمنتج
inputs = inputs.filter(input => input.productId !== id);
outputs = outputs.filter(output => output.productId !== id);
} else {
return; // إلغاء الحذف إذا لم يوافق المستخدم على حذف الحركات
}
}
// حذف المنتج
products = products.filter(p => p.id !== id);
saveData();
renderProducts();
renderInputs();
renderOutputs();
renderTransactions();
// تحديث الفئات بعد الحذف
updateCategoriesFromProducts();
alert(`تم حذف المنتج "${product.name}" بنجاح`);
}
}
// تحديث الفئات بناءً على المنتجات المتبقية
function updateCategoriesFromProducts() {
const usedCategories = [...new Set(products.map(p => p.category))];
categories = usedCategories;
saveData();
updateCategories();
}
// تهيئة التطبيق
document.addEventListener('DOMContentLoaded', function() {
// تعيين التاريخ الحالي كقيمة افتراضية
const today = new Date().toISOString().split('T')[0];
inputDateInput.value = today;
outputDateInput.value = today;
// التحقق من حالة المستخدم
checkUserStatus();
});
</script>
</body>
</html>
